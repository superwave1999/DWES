{"changed":true,"filter":false,"title":"index.php","tooltip":"/index.php","value":"<?php\n\nrequire './classes/autoload.php';\nrequire './classes/vendor/autoload.php';\nrequire_once './templates/Navlinks.php';\nuse izv\\data\\Usuario;\nuse izv\\data\\Photo;\nuse izv\\database\\Database;\nuse izv\\managedata\\ManageUsuario;\nuse izv\\managedata\\ManagePhoto;\nuse izv\\tools\\Reader;\nuse izv\\tools\\Alert;\nuse izv\\tools\\Util;\nuse izv\\tools\\Session;\nuse izv\\app\\App;\n\n\n$sesion = new Session(App::SESSION_NAME);\n\n$userLogin = null;\n$loggedUser = $sesion -> isLogged();\n$adminUser = $sesion -> isAdmin();\nif($loggedUser) {\n    $userLogin = $sesion->getLogin();\n}\n\n\n\nif (!$loggedUser) {\n  header('Location: login.php');\n  exit();\n}\n\n//Display content on page\n$db = new Database();\n$photomanager = new ManagePhoto($db);\n//$user = $sesion->getLogin();\n$userid = $userLogin->getId();\n$useradmin = $adminUser;\n\n$photos = $photomanager->getAll($userid);\n$db->close();\n\n\n//$alert = Alert::getMessage(Reader::get('op'), Reader::get('resultado'));\n\n\n\n// All ok, render page\n$loader = new \\Twig_Loader_Filesystem(__DIR__ . '/templates');\n$twig = new \\Twig_Environment($loader);\n$pagename = array('caption' => 'Dashboard - Instasnap');\necho $twig -> render('head.html', ['ptitle' => $pagename]);\n\nif ($useradmin) {\n  echo $twig -> render('navbar.html', ['lista' => Navlinks::getLinksRoot(),\n                                    'listaadm' => Navlinks::getAdminLinksRoot(),\n                                    'home' => Navlinks::getTitleRoot()]);\n} else {\n    echo $twig -> render('navbar.html', ['lista' => Navlinks::getLinksRoot(),\n                                    'home' => Navlinks::getTitleRoot()]);\n}\n    \n    ?>\n    <div class=\"jumbotron text-center\">\n      <h2>Welcome back!</h2>\n      <?php\n                            foreach($photos as $photo) {\n                                  if ($photo->getMime_Type() == \"video/mp4\") {\n                                ?>    \n                                    <video width=\"680\" height=\"480\" controls>\n                                      <source src=\"<?php  echo './uploads/'.$photo->getUserId().'/' .$photo->getSto_Filename(); ?>\" type=\"video/mp4\">\n                                      Your browser doesnt support embedded videos.\n                                    </video> <br>\n                                <?php\n                                  } else {\n                                ?>  \n\n                                    <img src=\"<?php  echo './uploads/'.$photo->getUserId().'/' .$photo->getSto_Filename(); ?>\" /><br>\n\n                                <?php    \n                                  } \n                                ?>\n\n                                <h4><?php  echo $photo->getDescription(); ?></h4><br>\n                                <a href=\"./user?uid=<?php  echo $photo->getUserId(); ?>\"><?php  echo $photo->getUserId(); ?></a><br>\n                                <p><?php  echo $photo->getOr_Filename(); ?></p><br>\n\n                                <?php\n                                \n                                if ($userid == $photo->getUserId()) {\n                                ?>\n                                  <a href=\"./editpost?pid=<?php  echo $photo->getId(); ?>\" class=\"btn btn-success\">Edit</a><br>\n\n  \n<?php\n                            }\n\n                            }\n                        ?>\n\n    </div>\n<?php\necho $twig -> render('footer.html');","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":48,"column":0},"end":{"row":55,"column":0},"action":"remove","lines":["","","","","","","",""],"id":2},{"start":{"row":47,"column":0},"end":{"row":48,"column":0},"action":"remove","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":360,"scrollleft":0,"selection":{"start":{"row":47,"column":0},"end":{"row":47,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":51,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1544027412022}